name: 🙏 Bot Prosperidad Divina - Comentarios Automáticos

on:
  schedule:
    - cron: '0 */4 * * *'  # Cada 4 horas
  workflow_dispatch: # Ejecución manual

jobs:
  bendecir-comentarios:
    runs-on: ubuntu-latest
    
    steps:
    - name: 📥 Descargar repositorio
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: 🐍 Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: 📦 Instalar dependencias
      run: |
        pip install google-generativeai google-auth google-auth-oauthlib google-api-python-client python-dateutil
        
    - name: 🔍 Debug - Verificar variables
      run: |
        echo "GEMINI_API_KEY existe: $([ -n "$GEMINI_API_KEY" ] && echo "SI" || echo "NO")"
        echo "YOUTUBE_CREDENTIALS_COMMENTS existe: $([ -n "$YOUTUBE_CREDENTIALS_COMMENTS" ] && echo "SI" || echo "NO")"
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        YOUTUBE_CREDENTIALS_COMMENTS: ${{ secrets.YOUTUBE_CREDENTIALS_COMMENTS }}
        
    - name: 👑 Ejecutar Bot Prosperidad Divina
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        YOUTUBE_CREDENTIALS_COMMENTS: ${{ secrets.YOUTUBE_CREDENTIALS_COMMENTS }}
      run: |
        python bot_prosperidad_divina_HIBRIDO.py
        
    - name: 📊 Crear reporte básico
      run: |
        echo "# 👑 Reporte Prosperidad Divina - $(date +'%d de %B %H:%M')" > REPORTE_BENDICIONES.md
        echo "" >> REPORTE_BENDICIONES.md
        echo "## ✨ Ministerio Digital Ejecutado:" >> REPORTE_BENDICIONES.md
        echo "- ⏰ Fecha: $(date +'%Y-%m-%d %H:%M:%S')" >> REPORTE_BENDICIONES.md
        echo "- 🤖 Bot ejecutado automáticamente" >> REPORTE_BENDICIONES.md
        echo "- 📊 Estadísticas detalladas en archivos JSON" >> REPORTE_BENDICIONES.md
        echo "" >> REPORTE_BENDICIONES.md
        echo "---" >> REPORTE_BENDICIONES.md
        echo "*🔄 Próxima ejecución automática en 4 horas*" >> REPORTE_BENDICIONES.md
        echo "*👑 Prosperidad Divina - Ministerio Digital Automático*" >> REPORTE_BENDICIONES.md
        
    - name: 💾 Guardar resultados
      run: |
        git config --local user.email "prosperidad@divina.ministerio"
        git config --local user.name "Bot Prosperidad Divina"
        git add .
        
        if ! git diff --staged --quiet; then
          git commit -m "👑 Bendiciones Automáticas $(date +'%d/%m/%Y %H:%M') - Ministerio digital activo ✨"
          git push
          echo "✅ Bendiciones registradas en el repositorio"
        else
          echo "ℹ️ No hay nuevas bendiciones para registrar"
        fi
        
    - name: 🎉 Confirmación de éxito
      if: success()
      run: |
        echo "✅ ¡Ronda de bendiciones completada!"
        echo "👑 Prosperidad Divina expandiéndose automáticamente"
        echo "🔄 Nos vemos en 4 horas para más ministerio"
        
    - name: 🚨 Manejo de errores
      if: failure()
      run: |
        echo "❌ Hubo un problema en el ministerio digital"
        echo "🙏 El ministerio continuará en la próxima ejecución"
